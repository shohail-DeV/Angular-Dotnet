ç
PC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Services\TokenService.cs
	namespace 	
	SimpleAPI
 
. 
Services 
; 
public

 
class

 
TokenService

 
(

 
IConfiguration

 (
config

) /
)

/ 0
:

1 2
ITokenService

3 @
{ 
public 

String 
CreateToken 
( 
User "
user# '
)' (
{ 
var 
tokenKey 
= 
config 
[ 
$str (
]( )
??* ,
throw- 2
new3 6
	Exception7 @
(@ A
$strA j
)j k
;k l
if 

( 
tokenKey 
. 
Length 
< 
$num  
)  !
throw" '
new( +
	Exception, 5
(5 6
$str6 X
)X Y
;Y Z
var 
key 
= 
new  
SymmetricSecurityKey *
(* +
Encoding+ 3
.3 4
UTF84 8
.8 9
GetBytes9 A
(A B
tokenKeyB J
)J K
)K L
;L M
var 
creds 
= 
new 
SigningCredentials *
(* +
key+ .
,. /
SecurityAlgorithms0 B
.B C
HmacSha256SignatureC V
)V W
;W X
var 
claims 
= 
new 
List 
< 
Claim #
># $
{ 	
new 
( 

ClaimTypes 
. 
NameIdentifier )
,) *
user+ /
./ 0
Id0 2
.2 3
ToString3 ;
(; <
)< =
)= >
,> ?
new 
( 

ClaimTypes 
. 
Name 
,  
user! %
.% &
UserName& .
). /
,/ 0
} 	
;	 

var 
tokenDescriptor 
= 
new !#
SecurityTokenDescriptor" 9
{ 	
Subject 
= 
new 
ClaimsIdentity (
(( )
claims) /
)/ 0
,0 1
Expires 
= 
DateTime 
. 
UtcNow %
.% &
AddDays& -
(- .
$num. /
)/ 0
,0 1
SigningCredentials 
=  
creds! &
}   	
;  	 

var"" 
tokenHandler"" 
="" 
new"" #
JwtSecurityTokenHandler"" 6
(""6 7
)""7 8
;""8 9
var## 
token## 
=## 
tokenHandler##  
.##  !
CreateToken##! ,
(##, -
tokenDescriptor##- <
)##< =
;##= >
return%% 
tokenHandler%% 
.%% 

WriteToken%% &
(%%& '
token%%' ,
)%%, -
;%%- .
}&& 
}(( ê
PC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Services\PhotoService.cs
	namespace 	
	SimpleAPI
 
. 
Services 
; 
public		 
class		 
PhotoService		 
:		 
IPhotoService		 )
{

 
private 
readonly 

Cloudinary 
_cloudinary  +
;+ ,
public 

PhotoService 
( 
IOptions  
<  !
CloudinarySettings! 3
>3 4
config5 ;
); <
{ 
var 
acc 
= 
new 
Account 
( 
config 
. 
Value 
. 
	CloudName "
," #
config 
. 
Value 
. 
ApiKey 
,  
config 
. 
Value 
. 
	ApiSecret "
) 	
;	 

_cloudinary 
= 
new 

Cloudinary $
($ %
acc% (
)( )
;) *
} 
public 

async 
Task 
< 
ImageUploadResult '
>' (
AddPhotoAsync) 6
(6 7
	IFormFile7 @
fileA E
)E F
{ 
var 
uploadResult 
= 
new 
ImageUploadResult 0
(0 1
)1 2
;2 3
if 

( 
file 
. 
Length 
> 
$num 
) 
{ 	
using 
var 
stream 
= 
file #
.# $
OpenReadStream$ 2
(2 3
)3 4
;4 5
var 
uploadParams 
= 
new "
ImageUploadParams# 4
{ 
File 
= 
new 
FileDescription *
(* +
file+ /
./ 0
FileName0 8
,8 9
stream: @
)@ A
,A B
Transformation 
=  
new! $
Transformation% 3
(3 4
)4 5
.5 6
Height6 <
(< =
$num= @
)@ A
.A B
WidthB G
(G H
$numH K
)K L
.L M
CropM Q
(Q R
$strR X
)X Y
.Y Z
GravityZ a
(a b
$strb h
)h i
}   
;   
uploadResult!! 
=!! 
await!!  
_cloudinary!!! ,
.!!, -
UploadAsync!!- 8
(!!8 9
uploadParams!!9 E
)!!E F
;!!F G
}"" 	
return## 
uploadResult## 
;## 
}$$ 
public&& 

async&& 
Task&& 
<&& 
DeletionResult&& $
>&&$ %
DeletePhotoAsync&&& 6
(&&6 7
string&&7 =
publicId&&> F
)&&F G
{'' 
var(( 
deleteParams(( 
=(( 
new(( 
DeletionParams(( -
(((- .
publicId((. 6
)((6 7
;((7 8
var)) 
result)) 
=)) 
await)) 
_cloudinary)) &
.))& '
DestroyAsync))' 3
())3 4
deleteParams))4 @
)))@ A
;))A B
return** 
result** 
;** 
}++ 
},, Ÿ4
BC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddDbContext 
< 
AppDbContext *
>* +
(+ ,
options, 3
=>4 6
options7 >
.> ?
	UseSqlite? H
(H I
$strI c
)c d
)d e
;e f
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. 
	AddScoped 
< 
ITokenService (
,( )
TokenService* 6
>6 7
(7 8
)8 9
;9 :
builder 
. 
Services 
. 
	AddScoped 
< 
IUserRepository *
,* +
UserRepository, :
>: ;
(; <
)< =
;= >
builder 
. 
Services 
. 
	AddScoped 
< 
ILikesRepository +
,+ ,
LikesRepository- <
>< =
(= >
)> ?
;? @
builder 
. 
Services 
. 
AddAutoMapper 
( 
	AppDomain (
.( )
CurrentDomain) 6
.6 7
GetAssemblies7 D
(D E
)E F
)F G
;G H
builder 
. 
Services 
. 
	Configure 
< 
CloudinarySettings -
>- .
(. /
builder/ 6
.6 7
Configuration7 D
.D E

GetSectionE O
(O P
$strP d
)d e
)e f
;f g
builder 
. 
Services 
. 
	AddScoped 
< 
IPhotoService (
,( )
PhotoService* 6
>6 7
(7 8
)8 9
;9 :
builder 
. 
Services 
. 
	AddScoped 
< 
LogUserActivity *
>* +
(+ ,
), -
;- .
builder"" 
."" 
Services"" 
."" 
AddAuthentication"" "
(""" #
JwtBearerDefaults""# 4
.""4 5 
AuthenticationScheme""5 I
)""I J
.## 
AddJwtBearer## 
(## 
options## 
=>## 
{$$ 
var%% 
tokenKey%% 
=%% 
builder%% 
.%% 
Configuration%% ,
[%%, -
$str%%- 7
]%%7 8
??%%9 ;
throw%%< A
new%%B E
	Exception%%F O
(%%O P
$str%%P d
)%%d e
;%%e f
options&& 
.&& %
TokenValidationParameters&& )
=&&* +
new&&, /%
TokenValidationParameters&&0 I
{'' 	$
ValidateIssuerSigningKey(( $
=((% &
true((' +
,((+ ,
IssuerSigningKey)) 
=)) 
new)) " 
SymmetricSecurityKey))# 7
())7 8
Encoding))8 @
.))@ A
UTF8))A E
.))E F
GetBytes))F N
())N O
tokenKey))O W
)))W X
)))X Y
,))Y Z
ValidateIssuer** 
=** 
false** "
,**" #
ValidateAudience++ 
=++ 
false++ $
},, 	
;,,	 

}-- 
)-- 
;-- 
var// 
app// 
=// 	
builder//
 
.// 
Build// 
(// 
)// 
;// 
app44 
.44 
UseMiddleware44 
<44 
ExceptionMiddleware44 %
>44% &
(44& '
)44' (
;44( )
app55 
.55 
UseHttpsRedirection55 
(55 
)55 
;55 
app66 
.66 
UseCors66 
(66 
x66 
=>66 
x66 
.66 
AllowAnyHeader66 !
(66! "
)66" #
.66# $
AllowAnyMethod66$ 2
(662 3
)663 4
.664 5
WithOrigins665 @
(66@ A
$str66A X
)66X Y
)66Y Z
;66Z [
app99 
.99 
UseAuthentication99 
(99 
)99 
;99 
app:: 
.:: 
UseAuthorization:: 
(:: 
):: 
;:: 
app<< 
.<< 
MapControllers<< 
(<< 
)<< 
;<< 
using?? 
var?? 	
scope??
 
=?? 
app?? 
.?? 
Services?? 
.?? 
CreateScope?? *
(??* +
)??+ ,
;??, -
var@@ 
services@@ 
=@@ 
scope@@ 
.@@ 
ServiceProvider@@ $
;@@$ %
tryAA 
{BB 
varCC 
contextCC 
=CC 
servicesCC 
.CC 
GetRequiredServiceCC -
<CC- .
AppDbContextCC. :
>CC: ;
(CC; <
)CC< =
;CC= >
awaitDD 	
contextDD
 
.DD 
DatabaseDD 
.DD 
MigrateAsyncDD '
(DD' (
)DD( )
;DD) *
awaitEE 	
SeedEE
 
.EE 
	SeedUsersEE 
(EE 
contextEE  
)EE  !
;EE! "
}FF 
catchGG 
(GG 
	ExceptionGG 
exGG 
)GG 
{HH 
varII 
loggerII 
=II 
servicesII 
.II 
GetRequiredServiceII ,
<II, -
ILoggerII- 4
<II4 5
ProgramII5 <
>II< =
>II= >
(II> ?
)II? @
;II@ A
loggerJJ 

.JJ
 
LogErrorJJ 
(JJ 
exJJ 
,JJ 
$strJJ E
)JJE F
;JJF G
}KK 
appMM 
.MM 
RunMM 
(MM 
)MM 	
;MM	 
Ä
ZC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Middlewares\ExceptionMiddleware.cs
	namespace 	
	SimpleAPI
 
. 
Middlewares 
;  
public 
class 
ExceptionMiddleware  
(  !
RequestDelegate! 0
next1 5
,5 6
ILogger7 >
<> ?
ExceptionMiddleware? R
>R S
loggerT Z
,Z [
IHostEnvironment\ l
envm p
)p q
{ 
public 

async 
Task 
InvokeAsync !
(! "
HttpContext" -
context. 5
)5 6
{ 
try 
{ 	
await 
next 
( 
context 
) 
;  
} 	
catch 
( 
	Exception 
ex 
) 
{ 	
logger 
. 
LogError 
( 
ex 
, 
ex  "
." #
Message# *
)* +
;+ ,
context 
. 
Response 
. 
ContentType (
=) *
$str+ =
;= >
context 
. 
Response 
. 

StatusCode '
=( )
(* +
int+ .
). /
HttpStatusCode/ =
.= >
InternalServerError> Q
;Q R
var 
response 
= 
env 
. 
IsDevelopment ,
(, -
)- .
? 
new 
ApiException 
( 
context &
.& '
Response' /
./ 0

StatusCode0 :
,: ;
ex< >
.> ?
Message? F
,F G
exH J
.J K

StackTraceK U
)U V
: 
new 
ApiException 
( 
context &
.& '
Response' /
./ 0

StatusCode0 :
,: ;
ex< >
.> ?
Message? F
,F G
$strH _
)_ `
;` a
var!! 
options!! 
=!! 
new!! !
JsonSerializerOptions!! 3
{""  
PropertyNamingPolicy## $
=##% &
JsonNamingPolicy##' 7
.##7 8
	CamelCase##8 A
}$$ 
;$$ 
var'' 
json'' 
='' 
JsonSerializer'' %
.''% &
	Serialize''& /
(''/ 0
response''0 8
,''8 9
options'': A
)''A B
;''B C
await** 
context** 
.** 
Response** "
.**" #

WriteAsync**# -
(**- .
json**. 2
)**2 3
;**3 4
}++ 	
},, 
}.. ð
UC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Interfaces\IUserRepository.cs
	namespace 	
	SimpleAPI
 
. 

Interfaces 
; 
public 
	interface 
IUserRepository  
{ 
void		 
Update			 
(		 
User		 
user		 
)		 
;		 
Task

 
<

 	
bool

	 
>

 
SaveAllAsync

 
(

 
)

 
;

 
Task 
< 	
IEnumerable	 
< 
User 
> 
> 
GetUsersAsync )
() *
)* +
;+ ,
Task 
< 	
User	 
? 
> 
GetUserByIdAsync  
(  !
int! $
id% '
)' (
;( )
Task 
< 	
User	 
? 
> "
GetUserByUserNameAsync &
(& '
string' -
username. 6
)6 7
;7 8
Task 
< 	
	PagedList	 
< 
	MemberDto 
> 
> 
GetMembersAsync .
(. /

UserParams/ 9

userParams: D
)D E
;E F
Task 
< 	
	MemberDto	 
? 
> $
GetMemberByUserNameAsync -
(- .
string. 4
username5 =
)= >
;> ?
Task 
< 	
	MemberDto	 
? 
> 
GetMemberByIdAsync '
(' (
int( +
id, .
). /
;/ 0
} “
SC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Interfaces\ITokenService.cs
	namespace 	
	SimpleAPI
 
. 

Interfaces 
; 
public 
	interface 
ITokenService 
{ 
String 

CreateToken 
( 
User 
user  
)  !
;! "
} –
SC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Interfaces\IPhotoService.cs
	namespace 	
	SimpleAPI
 
. 

Interfaces 
; 
public 
	interface 
IPhotoService 
{ 
Task 
< 	
ImageUploadResult	 
> 
AddPhotoAsync )
() *
	IFormFile* 3
file4 8
)8 9
;9 :
Task 
< 	
DeletionResult	 
> 
DeletePhotoAsync )
() *
string* 0
publicId1 9
)9 :
;: ;
}		 ¶
VC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Interfaces\ILikesRepository.cs
	namespace 	
	SimpleAPI
 
. 

Interfaces 
; 
public 
	interface 
ILikesRepository !
{ 
Task		 
<		 	
UserLike			 
?		 
>		 
GetUserLike		 
(		  
int		  #
sourceUserId		$ 0
,		0 1
int		2 5
targetUserId		6 B
)		B C
;		C D
Task

 
<

 	
IEnumerable

	 
<

 
	MemberDto

 
>

 
>

  
GetUserLikes

! -
(

- .
string

. 4
	predicate

5 >
,

> ?
int

@ C
userId

D J
)

J K
;

K L
Task 
< 	
IEnumerable	 
< 
int 
> 
> !
GetCurrentUserLikeIds 0
(0 1
int1 4
currentUserId5 B
)B C
;C D
void 

DeleteLike	 
( 
UserLike 
like !
)! "
;" #
void 
AddLike	 
( 
UserLike 
like 
) 
;  
Task 
< 	
bool	 
> 
SaveChanges 
( 
) 
; 
} Œ
MC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Helpers\UserParams.cs
	namespace 	
	SimpleAPI
 
. 
Helpers 
; 
public 
class 

UserParams 
{ 
private 
const 
int 
MaxPageSize !
=" #
$num$ &
;& '
public 

int 

PageNumber 
{ 
get 
;  
set! $
;$ %
}& '
=( )
$num* +
;+ ,
private 
int 
	_pageSize 
= 
$num 
; 
public		 

int		 
PageSize		 
{

 
get 
=> 
	_pageSize 
; 
set 
=> 
	_pageSize 
= 
( 
value !
>" #
MaxPageSize$ /
)/ 0
?1 2
MaxPageSize3 >
:? @
valueA F
;F G
} 
public 

String 
? 
Gender 
{ 
get 
;  
set! $
;$ %
}& '
public 

String 
? 
CurrentUsername "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

int 
MinAge 
{ 
get 
; 
set  
;  !
}" #
=$ %
$num& (
;( )
public 

int 
MaxAge 
{ 
get 
; 
set  
;  !
}" #
=$ %
$num& )
;) *
public 

string 
OrderBy 
{ 
get 
;  
set! $
;$ %
}& '
=( )
$str* 6
;6 7
} Í

SC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Helpers\PaginationHeader.cs
	namespace 	
	SimpleAPI
 
. 
Helpers 
; 
public 
class 
PaginationHeader 
( 
int !
currentPage" -
,- .
int/ 2
itemsPerPage3 ?
,? @
intA D

totalItemsE O
,O P
intQ T

totalPagesU _
)_ `
{ 
public 

int 
CurrentPage 
{ 
get  
;  !
set" %
;% &
}' (
=) *
currentPage+ 6
;6 7
public 

int 
ItemsPerPage 
{ 
get !
;! "
set# &
;& '
}( )
=* +
itemsPerPage, 8
;8 9
public 

int 

TotalItems 
{ 
get 
;  
set! $
;$ %
}& '
=( )

totalItems* 4
;4 5
public		 

int		 

TotalPages		 
{		 
get		 
;		  
set		! $
;		$ %
}		& '
=		( )

totalPages		* 4
;		4 5
}

 ô
LC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Helpers\PagedList.cs
	namespace 	
	SimpleAPI
 
. 
Helpers 
; 
public 
class 
	PagedList 
< 
T 
> 
: 
List  
<  !
T! "
>" #
{ 
public 

	PagedList 
( 
IEnumerable  
<  !
T! "
>" #
items$ )
,) *
int+ .
count/ 4
,4 5
int6 9

pageNumber: D
,D E
intF I
pageSizeJ R
)R S
{ 
CurrentPage		 
=		 

pageNumber		  
;		  !

TotalPages

 
=

 
(

 
int

 
)

 
Math

 
.

  
Ceiling

  '
(

' (
count

( -
/

. /
(

0 1
double

1 7
)

7 8
pageSize

8 @
)

@ A
;

A B
PageSize 
= 
pageSize 
; 

TotalCount 
= 
count 
; 
AddRange 
( 
items 
) 
; 
} 
public 

int 
CurrentPage 
{ 
get  
;  !
set" %
;% &
}' (
public 

int 

TotalPages 
{ 
get 
;  
set! $
;$ %
}& '
public 

int 
PageSize 
{ 
get 
; 
set "
;" #
}$ %
public 

int 

TotalCount 
{ 
get 
;  
set! $
;$ %
}& '
public 

static 
async 
Task 
< 
	PagedList &
<& '
T' (
>( )
>) *
CreateAsync+ 6
(6 7

IQueryable7 A
<A B
TB C
>C D
sourceE K
,K L
int8 ;

pageNumber< F
,F G
intH K
pageSizeL T
)T U
{ 
var 
count 
= 
await 
source  
.  !

CountAsync! +
(+ ,
), -
;- .
var 
items 
= 
await 
source  
.  !
Skip! %
(% &
(& '

pageNumber' 1
-2 3
$num4 5
)5 6
*7 8
pageSize9 A
)A B
.  !
Take! %
(% &
pageSize& .
). /
.  !
ToListAsync! ,
(, -
)- .
;. /
return 
new 
	PagedList 
< 
T 
> 
(  
items  %
,% &
count' ,
,, -

pageNumber. 8
,8 9
pageSize: B
)B C
;C D
} 
} Œ
RC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Helpers\LogUserActivity.cs
	namespace 	
	SimpleAPI
 
. 
Helpers 
; 
public 
class 
LogUserActivity 
: 
IAsyncActionFilter 1
{ 
public		 

async		 
Task		 "
OnActionExecutionAsync		 ,
(		, -"
ActionExecutingContext		- C
context		D K
,		K L#
ActionExecutionDelegate		M d
next		e i
)		i j
{

 
var 
resultContext 
= 
await !
next" &
(& '
)' (
;( )
if 

( 
context 
. 
HttpContext 
.  
User  $
.$ %
Identity% -
?- .
.. /
IsAuthenticated/ >
!=? A
trueB F
)F G
returnH N
;N O
var 
userId 
= 
resultContext "
." #
HttpContext# .
.. /
User/ 3
.3 4
	GetUserId4 =
(= >
)> ?
;? @
var 
repo 
= 
resultContext  
.  !
HttpContext! ,
., -
RequestServices- <
.< =
GetRequiredService= O
<O P
IUserRepositoryP _
>_ `
(` a
)a b
;b c
var 
user 
= 
await 
repo 
. 
GetUserByIdAsync .
(. /
userId/ 5
)5 6
;6 7
if 

( 
user 
== 
null 
) 
return  
;  !
user 
. 

LastActive 
= 
DateTime "
." #
UtcNow# )
;) *
await 
repo 
. 
SaveAllAsync 
(  
)  !
;! "
} 
} «
UC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Helpers\CloudinarySettings.cs
	namespace 	
	SimpleAPI
 
. 
Helpers 
; 
public 
class 
CloudinarySettings 
{ 
public 

required 
string 
	CloudName $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 

required 
string 
ApiKey !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

required 
string 
	ApiSecret $
{% &
get' *
;* +
set, /
;/ 0
}1 2
}		 ¯
UC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Helpers\AutomapperProfiles.cs
	namespace 	
	SimpleAPI
 
. 
Helpers 
; 
public 
class 
AutomapperProfiles 
:  !
Profile" )
{		 
public

 

AutomapperProfiles

 
(

 
)

 
{ 
	CreateMap 
< 
User 
, 
	MemberDto !
>! "
(" #
)# $
. 
	ForMember 
( 
destination "
=># %
destination& 1
.1 2
Age2 5
,5 6
options7 >
=>? A
optionsB I
. 
MapFrom 
( 
source 
=> 
source %
.% &
DateOfBirth& 1
.1 2
CalculateAge2 >
(> ?
)? @
)@ A
)A B
. 
	ForMember 
( 
destination "
=># %
destination& 1
.1 2
PhotoUrl2 :
,: ;
option< B
=>C E
optionF L
. 
MapFrom 
( 
source 
=> 
source %
.% &
Photos& ,
., -
FirstOrDefault- ;
(; <
x< =
=>> @
xA B
.B C
IsMainC I
)I J
!J K
.K L
UrlL O
)O P
)P Q
;Q R
	CreateMap 
< 
Photo 
, 
PhotoDto !
>! "
(" #
)# $
;$ %
	CreateMap 
< 
MemberUpdateDto !
,! "
User# '
>' (
(( )
)) *
;* +
	CreateMap 
< 
RegisterDto 
, 
User #
># $
($ %
)% &
;& '
	CreateMap 
< 
string 
, 
DateOnly "
>" #
(# $
)$ %
.% &
ConvertUsing& 2
(2 3
s3 4
=>5 7
DateOnly8 @
.@ A
ParseA F
(F G
sG H
)H I
)I J
;J K
} 
} è
TC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Extensions\HttpExtensions.cs
	namespace 	
	SimpleAPI
 
. 

Extensions 
; 
public 
static 
class 
HttpExtensions "
{ 
public 

static 
void 
AddPaginationHeader *
<* +
T+ ,
>, -
(- .
this. 2
HttpResponse3 ?
response@ H
,H I
	PagedListJ S
<S T
TT U
>U V
dataW [
)[ \
{		 
var

 
paginationHeader

 
=

 
new

 "
PaginationHeader

# 3
(

3 4
data

4 8
.

8 9
CurrentPage

9 D
,

D E
data

F J
.

J K
PageSize

K S
,

S T
data

U Y
.

Y Z

TotalCount

Z d
,

d e
data

f j
.

j k

TotalPages

k u
)

u v
;

v w
var 
jsonOptions 
= 
new !
JsonSerializerOptions 3
{ 	 
PropertyNamingPolicy  
=! "
JsonNamingPolicy# 3
.3 4
	CamelCase4 =
,= >
} 	
;	 

response 
. 
Headers 
. 
Append 
(  
$str  ,
,, -
JsonSerializer. <
.< =
	Serialize= F
(F G
paginationHeaderG W
,W X
jsonOptionsY d
)d e
)e f
;f g
response 
. 
Headers 
. 
Append 
(  
$str  ?
,? @
$strA M
)M N
;N O
} 
} ©	
XC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Extensions\DateTimeExtensions.cs
	namespace 	
	SimpleAPI
 
. 

Extensions 
; 
public 
static 
class 
DateTimeExtensions &
{ 
public 

static 
int 
CalculateAge "
(" #
this# '
DateOnly( 0
dob1 4
)4 5
{ 
var 
today 
= 
DateOnly 
. 
FromDateTime )
() *
DateTime* 2
.2 3
Now3 6
)6 7
;7 8
var		 
age		 
=		 
today		 
.		 
Year		 
-		 
dob		 "
.		" #
Year		# '
;		' (
if

 

(

 
dob

 
>

 
today

 
.

 
AddYears

  
(

  !
-

! "
age

" %
)

% &
)

& '
age

( +
--

+ -
;

- .
return 
age 
; 
} 
} É
NC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Errors\ApiException.cs
	namespace 	
	SimpleAPI
 
. 
Errors 
; 
public 
class 
ApiException 
( 
int 

statusCode (
,( )
string* 0
message1 8
,8 9
string: @
?@ A
detailsB I
)I J
{ 
public 

int 

statusCode 
{ 
get 
;  
set! $
;$ %
}& '
=( )

statusCode* 4
;4 5
public 

string 
message 
{ 
get 
;  
set! $
;$ %
}& '
=( )
message* 1
;1 2
public 

string 
? 
details 
{ 
get  
;  !
set" %
;% &
}' (
=) *
details+ 2
;2 3
} ñ
^C:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Extensions\ClaimsPrincipleExtension.cs
	namespace 	
	SimpleAPI
 
. 

Extensions 
; 
public 
static 
class $
ClaimsPrincipleExtension ,
{ 
public 

static 
string 
GetUserName $
($ %
this% )
ClaimsPrincipal* 9
user: >
)> ?
{ 
return		 
user		 
.		 
	FindFirst		 
(		 

ClaimTypes		 (
.		( )
Name		) -
)		- .
?		. /
.		/ 0
Value		0 5
??

 
throw

 
new

 
	Exception

 &
(

& '
$str

' f
)

f g
;

g h
} 
public 

static 
int 
	GetUserId 
(  
this  $
ClaimsPrincipal% 4
user5 9
)9 :
{ 
return 
int 
. 
Parse 
( 
user 
. 
	FindFirst '
(' (

ClaimTypes( 2
.2 3
NameIdentifier3 A
)A B
?B C
.C D
ValueD I
?? 
throw 
new 
	Exception &
(& '
$str' f
)f g
)g h
;h i
} 
} –?
RC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Entities\UserRepository.cs
	namespace		 	
	SimpleAPI		
 
.		 
Entities		 
;		 
public 
class 
UserRepository 
( 
AppDbContext (
context) 0
,0 1
IMapper2 9
mapper: @
)@ A
:B C
IUserRepositoryD S
{ 
public 

async 
Task 
< 
	MemberDto 
?  
>  !
GetMemberByIdAsync" 4
(4 5
int5 8
id9 ;
); <
{ 
return 
await 
context 
. 
Users "
. 
	ProjectTo &
<& '
	MemberDto' 0
>0 1
(1 2
mapper2 8
.8 9!
ConfigurationProvider9 N
)N O
. 
FirstOrDefaultAsync 0
(0 1
x1 2
=>3 5
x6 7
.7 8
Id8 :
==; =
id> @
)@ A
;A B
} 
public 

async 
Task 
< 
	MemberDto 
?  
>  !$
GetMemberByUserNameAsync" :
(: ;
string; A
usernameB J
)J K
{ 
return 
await 
context 
. 
Users "
. 
Where 
( 
x 
=> 
x  !
.! "
UserName" *
==+ -
username. 6
)6 7
. 
	ProjectTo 
< 
	MemberDto (
>( )
() *
mapper* 0
.0 1!
ConfigurationProvider1 F
)F G
.  
SingleOrDefaultAsync )
() *
)* +
;+ ,
} 
public 

async 
Task 
< 
	PagedList 
<  
	MemberDto  )
>) *
>* +
GetMembersAsync, ;
(; <

UserParams< F

userParamsG Q
)Q R
{ 
var 
query 
= 
context 
. 
Users !
.   
AsQueryable   '
(  ' (
)  ( )
;  ) *
query## 
=## 
query## 
.## 
Where## 
(## 
x## 
=>##  
x##! "
.##" #
UserName### +
!=##, .

userParams##/ 9
.##9 :
CurrentUsername##: I
)##I J
;##J K
if$$ 

($$ 

userParams$$ 
.$$ 
Gender$$ 
!=$$  
null$$! %
)$$% &
query$$' ,
=$$- .
query$$/ 4
.$$4 5
Where$$5 :
($$: ;
x$$; <
=>$$= ?
x$$@ A
.$$A B
Gender$$B H
==$$I K

userParams$$L V
.$$V W
Gender$$W ]
)$$] ^
;$$^ _
var&& 
minDob&& 
=&& 
DateOnly&& 
.&& 
FromDateTime&& *
(&&* +
DateTime&&+ 3
.&&3 4
Today&&4 9
.&&9 :
AddYears&&: B
(&&B C
-&&C D

userParams&&D N
.&&N O
MaxAge&&O U
-&&V W
$num&&X Y
)&&Y Z
)&&Z [
;&&[ \
var'' 
maxDob'' 
='' 
DateOnly'' 
.'' 
FromDateTime'' *
(''* +
DateTime''+ 3
.''3 4
Today''4 9
.''9 :
AddYears'': B
(''B C
-''C D

userParams''D N
.''N O
MinAge''O U
)''U V
)''V W
;''W X
query(( 
=(( 
query(( 
.(( 
Where(( 
((( 
x(( 
=>((  
x((! "
.((" #
DateOfBirth((# .
>=((/ 1
minDob((2 8
&&((9 ;
x((< =
.((= >
DateOfBirth((> I
<=((J L
maxDob((M S
)((S T
;((T U
query++ 
=++ 

userParams++ 
.++ 
OrderBy++ "
switch++# )
{,, 	
$str-- 
=>-- 
query-- 
.-- 
OrderByDescending-- 0
(--0 1
x--1 2
=>--3 5
x--6 7
.--7 8
Created--8 ?
)--? @
,--@ A
_.. 
=>.. 
query.. 
... 
OrderByDescending.. (
(..( )
x..) *
=>..+ -
x... /
.../ 0

LastActive..0 :
)..: ;
}// 	
;//	 

return11 
await11 
	PagedList11 
<11 
	MemberDto11 (
>11( )
.11) *
CreateAsync11* 5
(115 6
query116 ;
.11; <
	ProjectTo11< E
<11E F
	MemberDto11F O
>11O P
(11P Q
mapper11Q W
.11W X!
ConfigurationProvider11X m
)11m n
,11n o

userParams11p z
.11z {

PageNumber	11{ …
,
11… †

userParams
11‡ ‘
.
11‘ ’
PageSize
11’ š
)
11š ›
;
11› œ
}22 
public44 

async44 
Task44 
<44 
User44 
?44 
>44 
GetUserByIdAsync44 -
(44- .
int44. 1
id442 4
)444 5
{55 
return66 
await66 
context66 
.66 
Users66 "
.66" #

FirstAsync66# -
(66- .
x66. /
=>660 2
x663 4
.664 5
Id665 7
==668 :
id66; =
)66= >
;66> ?
}77 
public99 

async99 
Task99 
<99 
User99 
?99 
>99 "
GetUserByUserNameAsync99 3
(993 4
string994 :
username99; C
)99C D
{:: 
return;; 
await;; 
context;; 
.;; 
Users;; "
.<< 	
Include<<	 
(<< 
x<< 
=><< 
x<< 
.<< 
Photos<< 
)<< 
.== 	 
SingleOrDefaultAsync==	 
(== 
x== 
=>==  "
x==# $
.==$ %
UserName==% -
====. 0
username==1 9
)==9 :
;==: ;
}>> 
public@@ 

async@@ 
Task@@ 
<@@ 
IEnumerable@@ !
<@@! "
User@@" &
>@@& '
>@@' (
GetUsersAsync@@) 6
(@@6 7
)@@7 8
{AA 
returnBB 
awaitBB 
contextBB 
.BB 
UsersBB "
.CC 	
IncludeCC	 
(CC 
xCC 
=>CC 
xCC 
.CC 
PhotosCC 
)CC 
.DD 	
ToListAsyncDD	 
(DD 
)DD 
;DD 
}EE 
publicGG 

asyncGG 
TaskGG 
<GG 
boolGG 
>GG 
SaveAllAsyncGG (
(GG( )
)GG) *
{HH 
returnII 
awaitII 
contextII 
.II 
SaveChangesAsyncII -
(II- .
)II. /
>II0 1
$numII2 3
;II3 4
}JJ 
publicLL 

voidLL 
UpdateLL 
(LL 
UserLL 
userLL  
)LL  !
{MM 
contextNN 
.NN 
EntryNN 
(NN 
userNN 
)NN 
.NN 
StateNN !
=NN" #
EntityStateNN$ /
.NN/ 0
ModifiedNN0 8
;NN8 9
}OO 
}PP ó
LC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Entities\UserLike.cs
	namespace 	
	SimpleAPI
 
. 
Entities 
; 
public 
class 
UserLike 
{ 
public 

User 

SourceUser 
{ 
get  
;  !
set" %
;% &
}' (
=) *
null+ /
!/ 0
;0 1
public 

int 
SourceUserId 
{ 
get !
;! "
set# &
;& '
}( )
public		 

User		 

TargetUser		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
=		) *
null		+ /
!		/ 0
;		0 1
public

 

int

 
TargetUserId

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
} £
HC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Entities\User.cs
	namespace 	
	SimpleAPI
 
. 
Entities 
; 
public 
class 
User 
{ 
public 

int 
Id 
{ 
get 
; 
set 
; 
} 
public 

required 
String 
UserName #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public		 

byte		 
[		 
]		 
PasswordHash		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
=		- .
[		/ 0
]		0 1
;		1 2
public

 

byte

 
[

 
]

 
PasswordSalt

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
=

- .
[

/ 0
]

0 1
;

1 2
public 

DateOnly 
DateOfBirth 
{  !
get" %
;% &
set' *
;* +
}, -
public 

required 
String 
KnownAs "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

DateTime 
Created 
{ 
get !
;! "
set# &
;& '
}( )
=* +
DateTime, 4
.4 5
UtcNow5 ;
;; <
public 

DateTime 

LastActive 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
DateTime/ 7
.7 8
UtcNow8 >
;> ?
public 

required 
String 
Gender !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

string 
? 
Introduction 
{  !
get" %
;% &
set' *
;* +
}, -
public 

string 
? 
	Interests 
{ 
get "
;" #
set$ '
;' (
}) *
public 

string 
? 

LookingFor 
{ 
get  #
;# $
set% (
;( )
}* +
public 

required 
String 
City 
{  !
get" %
;% &
set' *
;* +
}, -
public 

required 
string 
Country "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

List 
< 
Photo 
> 
Photos 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
[. /
]/ 0
;0 1
public   

List   
<   
UserLike   
>   
LikedByUsers   &
{  ' (
get  ) ,
;  , -
set  . 1
;  1 2
}  3 4
=  5 6
[  7 8
]  8 9
;  9 :
public!! 

List!! 
<!! 
UserLike!! 
>!! 

LikedUsers!! $
{!!% &
get!!' *
;!!* +
set!!, /
;!!/ 0
}!!1 2
=!!3 4
[!!5 6
]!!6 7
;!!7 8
}## Ë

IC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Entities\Photo.cs
	namespace 	
	SimpleAPI
 
. 
Entities 
; 
[ 
Table 
( 
$str 
) 
] 
public 
class 
Photo 
{ 
public 

int 
Id 
{ 
get 
; 
set 
; 
} 
public		 

required		 
String		 
Url		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public

 

bool

 
IsMain

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
public 

string 
? 
PublicId 
{ 
get !
;! "
set# &
;& '
}( )
public 

int 
UserId 
{ 
get 
; 
set  
;  !
}" #
public 

User 
User 
{ 
get 
; 
set 
;  
}! "
=# $
null% )
!) *
;* +
} ¼.
SC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Entities\LikesRepository.cs
	namespace		 	
	SimpleAPI		
 
.		 
Entities		 
;		 
public 
class 
LikesRepository 
( 
AppDbContext )
context* 1
,1 2
IMapper3 :
mapper; A
)A B
:C D
ILikesRepositoryE U
{ 
public 

void 
AddLike 
( 
UserLike  
like! %
)% &
{ 
context 
. 
Likes 
. 
Add 
( 
like 
) 
;  
} 
public 

void 

DeleteLike 
( 
UserLike #
like$ (
)( )
{ 
context 
. 
Likes 
. 
Remove 
( 
like !
)! "
;" #
} 
public 

async 
Task 
< 
IEnumerable !
<! "
int" %
>% &
>& '!
GetCurrentUserLikeIds( =
(= >
int> A
currentUserIdB O
)O P
{ 
return 
await 
context 
. 
Likes "
. 
Where "
(" #
x# $
=>% '
x( )
.) *
SourceUserId* 6
==7 9
currentUserId: G
)G H
. 
Select #
(# $
x$ %
=>& (
x) *
.* +
TargetUserId+ 7
)7 8
. 
ToListAsync (
(( )
)) *
;* +
} 
public 

async 
Task 
< 
UserLike 
? 
>  
GetUserLike! ,
(, -
int- 0
sourceUserId1 =
,= >
int? B
targetUserIdC O
)O P
{   
return!! 
await!! 
context!! 
.!! 
Likes!! "
.!!" #
	FindAsync!!# ,
(!!, -
sourceUserId!!- 9
,!!9 :
targetUserId!!; G
)!!G H
;!!H I
}"" 
public$$ 

async$$ 
Task$$ 
<$$ 
IEnumerable$$ !
<$$! "
	MemberDto$$" +
>$$+ ,
>$$, -
GetUserLikes$$. :
($$: ;
string$$; A
	predicate$$B K
,$$K L
int$$M P
userId$$Q W
)$$W X
{%% 
var&& 
likes&& 
=&& 
context&& 
.&& 
Likes&& !
.&&! "
AsQueryable&&" -
(&&- .
)&&. /
;&&/ 0
switch'' 
('' 
	predicate'' 
)'' 
{(( 	
case)) 
$str)) 
:)) 
return** 
await** 
likes** "
.++ 
Where++ "
(++" #
x++# $
=>++% '
x++( )
.++) *
SourceUserId++* 6
==++7 9
userId++: @
)++@ A
.,, 
Select,, #
(,,# $
x,,$ %
=>,,& (
x,,) *
.,,* +

TargetUser,,+ 5
),,5 6
.-- 
	ProjectTo-- &
<--& '
	MemberDto--' 0
>--0 1
(--1 2
mapper--2 8
.--8 9!
ConfigurationProvider--9 N
)--N O
... 
ToListAsync.. (
(..( )
)..) *
;..* +
case// 
$str// 
:// 
return00 
await00 
likes00 "
.11 
Where11 "
(11" #
x11# $
=>11% '
x11( )
.11) *
TargetUserId11* 6
==117 9
userId11: @
)11@ A
.22 
Select22 #
(22# $
x22$ %
=>22& (
x22) *
.22* +

SourceUser22+ 5
)225 6
.33 
	ProjectTo33 &
<33& '
	MemberDto33' 0
>330 1
(331 2
mapper332 8
.338 9!
ConfigurationProvider339 N
)33N O
.44 
ToListAsync44 (
(44( )
)44) *
;44* +
default55 
:55 
var66 
likeIds66 
=66 
await66 #!
GetCurrentUserLikeIds66$ 9
(669 :
userId66: @
)66@ A
;66A B
return88 
await88 
likes88 "
.99 
Where99 "
(99" #
x99# $
=>99% '
x99( )
.99) *
TargetUserId99* 6
==997 9
userId99: @
&&99A C
likeIds99D K
.99K L
Contains99L T
(99T U
x99U V
.99V W
SourceUserId99W c
)99c d
)99d e
.:: 
Select:: #
(::# $
x::$ %
=>::& (
x::) *
.::* +

SourceUser::+ 5
)::5 6
.;; 
	ProjectTo;; &
<;;& '
	MemberDto;;' 0
>;;0 1
(;;1 2
mapper;;2 8
.;;8 9!
ConfigurationProvider;;9 N
);;N O
.<< 
ToListAsync<< (
(<<( )
)<<) *
;<<* +
}>> 	
}?? 
publicAA 

asyncAA 
TaskAA 
<AA 
boolAA 
>AA 
SaveChangesAA '
(AA' (
)AA( )
{BB 
returnCC 
awaitCC 
contextCC 
.CC 
SaveChangesAsyncCC -
(CC- .
)CC. /
>CC0 1
$numCC2 3
;CC3 4
}DD 
}EE ä
FC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\DTO\UserDto.cs
	namespace 	
	SimpleAPI
 
. 
DTO 
; 
public 
class 
UserDto 
{ 
public 

required 
String 
Username #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 

required 
String 
Token  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

required 
String 
KnownAs "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

required 
String 
Gender !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 

String		 
?		 
PhotoUrl		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
}

 Ð
JC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\DTO\RegisterDto.cs
	namespace 	
	SimpleAPI
 
. 
DTO 
; 
public 
class 
RegisterDto 
{ 
[ 
Required 
] 
public 

String 
Username 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
[

 
Required

 
]

 
public 

String 
? 
KnownAs 
{ 
get  
;  !
set" %
;% &
}' (
[ 
Required 
] 
public 

String 
? 
Gender 
{ 
get 
;  
set! $
;$ %
}& '
[ 
Required 
] 
public 

String 
? 
DateOfBirth 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 
Required 
] 
public 

String 
? 
City 
{ 
get 
; 
set "
;" #
}$ %
[ 
Required 
] 
public 

String 
? 
Country 
{ 
get  
;  !
set" %
;% &
}' (
[ 
Required 
] 
[ 
StringLength 
( 
$num 
, 
MinimumLength "
=# $
$num% &
)& '
]' (
public 

String 
Password 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} Ê
GC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\DTO\PhotoDto.cs
	namespace 	
	SimpleAPI
 
. 
DTO 
; 
public 
class 
PhotoDto 
{ 
public 

int 
Id 
{ 
get 
; 
set 
; 
} 
public 

String 
? 
Url 
{ 
get 
; 
set !
;! "
}# $
public 

bool 
IsMain 
{ 
get 
; 
set !
;! "
}# $
}		 à
NC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\DTO\MemberUpdateDto.cs
	namespace 	
	SimpleAPI
 
. 
DTO 
; 
public 
class 
MemberUpdateDto 
{ 
public 

string 
? 
Introduction 
{  !
get" %
;% &
set' *
;* +
}, -
public 

string 
? 

LookingFor 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
? 
	Interests 
{ 
get "
;" #
set$ '
;' (
}) *
public 

string 
? 
City 
{ 
get 
; 
set "
;" #
}$ %
public		 

string		 
?		 
Country		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
} Û
HC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\DTO\MemberDto.cs
	namespace 	
	SimpleAPI
 
. 
DTO 
; 
public 
class 
	MemberDto 
{ 
public 

int 
Id 
{ 
get 
; 
set 
; 
} 
public 

String 
? 
Username 
{ 
get !
;! "
set# &
;& '
}( )
public 

int 
Age 
{ 
get 
; 
set 
; 
}  
public 

String 
? 
PhotoUrl 
{ 
get !
;! "
set# &
;& '
}( )
public		 

String		 
?		 
KnownAs		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
public

 

DateTime

 
Created

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
=

* +
DateTime

, 4
.

4 5
UtcNow

5 ;
;

; <
public 

DateTime 

LastActive 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
DateTime/ 7
.7 8
UtcNow8 >
;> ?
public 

String 
? 
Gender 
{ 
get 
;  
set! $
;$ %
}& '
public 

String 
? 
Introduction 
{  !
get" %
;% &
set' *
;* +
}, -
public 

String 
? 
	Interests 
{ 
get "
;" #
set$ '
;' (
}) *
public 

String 
? 

LookingFor 
{ 
get  #
;# $
set% (
;( )
}* +
public 

String 
? 
City 
{ 
get 
; 
set "
;" #
}$ %
public 

String 
? 
Country 
{ 
get  
;  !
set" %
;% &
}' (
public 

List 
< 
PhotoDto 
> 
Photos  
{! "
get# &
;& '
set( +
;+ ,
}- .
} Á
GC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\DTO\LoginDto.cs
	namespace 	
	SimpleAPI
 
. 
DTO 
; 
public 
class 
LoginDto 
{ 
[ 
Required 
] 
public 

String 
Username 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
[		 
Required		 
]		 
public

 

String

 
Password

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
=

) *
string

+ 1
.

1 2
Empty

2 7
;

7 8
} ó
DC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Data\Seed.cs
	namespace 	
	SimpleAPI
 
. 
Data 
; 
public		 
class		 
Seed		 
{

 
public 

static 
async 
Task 
	SeedUsers &
(& '
AppDbContext' 3
	dbContext4 =
)= >
{ 
if 

( 
await 
	dbContext 
. 
Users !
.! "
AnyAsync" *
(* +
)+ ,
), -
return. 4
;4 5
var 
userData 
= 
await 
File !
.! "
ReadAllTextAsync" 2
(2 3
$str3 K
)K L
;L M
var 
options 
= 
new !
JsonSerializerOptions /
{ 	'
PropertyNameCaseInsensitive '
=( )
true* .
} 	
;	 

var 
users 
= 
JsonSerializer "
." #
Deserialize# .
<. /
List/ 3
<3 4
User4 8
>8 9
>9 :
(: ;
userData; C
,C D
optionsE L
)L M
;M N
if 

( 
users 
== 
null 
) 
return !
;! "
foreach 
( 
var 
user 
in 
users "
)" #
{ 	
using 
var 
hmac 
= 
new  

HMACSHA512! +
(+ ,
), -
;- .
user 
. 
UserName 
= 
user  
.  !
UserName! )
.) *
ToLower* 1
(1 2
)2 3
;3 4
user 
. 
PasswordHash 
= 
hmac  $
.$ %
ComputeHash% 0
(0 1
Encoding1 9
.9 :
UTF8: >
.> ?
GetBytes? G
(G H
$strH R
)R S
)S T
;T U
user 
. 
PasswordSalt 
= 
hmac  $
.$ %
Key% (
;( )
	dbContext 
. 
Users 
. 
Add 
(  
user  $
)$ %
;% &
}   	
await!! 
	dbContext!! 
.!! 
SaveChangesAsync!! (
(!!( )
)!!) *
;!!* +
}"" 
}## ª
fC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Data\Migrations\20250718111858_AddUserLikes.cs
	namespace 	
	SimpleAPI
 
. 
Data 
. 

Migrations #
{ 
public 

partial 
class 
AddUserLikes %
:& '
	Migration( 1
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
SourceUserId  
=! "
table# (
.( )
Column) /
</ 0
int0 3
>3 4
(4 5
type5 9
:9 :
$str; D
,D E
nullableF N
:N O
falseP U
)U V
,V W
TargetUserId  
=! "
table# (
.( )
Column) /
</ 0
int0 3
>3 4
(4 5
type5 9
:9 :
$str; D
,D E
nullableF N
:N O
falseP U
)U V
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
new6 9
{: ;
x< =
.= >
SourceUserId> J
,J K
xL M
.M N
TargetUserIdN Z
}[ \
)\ ]
;] ^
table 
. 

ForeignKey $
($ %
name 
: 
$str ;
,; <
column 
: 
x  !
=>" $
x% &
.& '
SourceUserId' 3
,3 4
principalTable &
:& '
$str( /
,/ 0
principalColumn '
:' (
$str) -
,- .
onDelete  
:  !
ReferentialAction" 3
.3 4
Cascade4 ;
); <
;< =
table 
. 

ForeignKey $
($ %
name 
: 
$str ;
,; <
column 
: 
x  !
=>" $
x% &
.& '
TargetUserId' 3
,3 4
principalTable   &
:  & '
$str  ( /
,  / 0
principalColumn!! '
:!!' (
$str!!) -
,!!- .
onDelete""  
:""  !
ReferentialAction""" 3
.""3 4
Cascade""4 ;
)""; <
;""< =
}## 
)## 
;## 
migrationBuilder%% 
.%% 
CreateIndex%% (
(%%( )
name&& 
:&& 
$str&& -
,&&- .
table'' 
:'' 
$str'' 
,'' 
column(( 
:(( 
$str(( &
)((& '
;((' (
})) 	
	protected,, 
override,, 
void,, 
Down,,  $
(,,$ %
MigrationBuilder,,% 5
migrationBuilder,,6 F
),,F G
{-- 	
migrationBuilder.. 
... 
	DropTable.. &
(..& '
name// 
:// 
$str// 
)// 
;// 
}00 	
}11 
}22 ”
qC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Data\Migrations\20250620172633_RenamesInterestsInUsers.cs
	namespace 	
	SimpleAPI
 
. 
Data 
. 

Migrations #
{ 
public 

partial 
class #
RenamesInterestsInUsers 0
:1 2
	Migration3 <
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
RenameColumn )
() *
name 
: 
$str  
,  !
table 
: 
$str 
, 
newName 
: 
$str $
)$ %
;% &
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
RenameColumn )
() *
name 
: 
$str !
,! "
table 
: 
$str 
, 
newName 
: 
$str #
)# $
;$ %
} 	
} 
} ×^
lC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Data\Migrations\20250620103541_UpdatedUsersEntity.cs
	namespace 	
	SimpleAPI
 
. 
Data 
. 

Migrations #
{ 
public		 

partial		 
class		 
UpdatedUsersEntity		 +
:		, -
	Migration		. 7
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str 
, 
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue 
: 
$str  
)  !
;! "
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str 
,  
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue 
: 
$str  
)  !
;! "
migrationBuilder 
. 
	AddColumn &
<& '
DateTime' /
>/ 0
(0 1
name 
: 
$str 
,  
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable   
:   
false   
,    
defaultValue!! 
:!! 
new!! !
DateTime!!" *
(!!* +
$num!!+ ,
,!!, -
$num!!. /
,!!/ 0
$num!!1 2
,!!2 3
$num!!4 5
,!!5 6
$num!!7 8
,!!8 9
$num!!: ;
,!!; <
$num!!= >
,!!> ?
DateTimeKind!!@ L
.!!L M
Unspecified!!M X
)!!X Y
)!!Y Z
;!!Z [
migrationBuilder## 
.## 
	AddColumn## &
<##& '
DateOnly##' /
>##/ 0
(##0 1
name$$ 
:$$ 
$str$$ #
,$$# $
table%% 
:%% 
$str%% 
,%% 
type&& 
:&& 
$str&& 
,&& 
nullable'' 
:'' 
false'' 
,''  
defaultValue(( 
:(( 
new(( !
DateOnly((" *
(((* +
$num((+ ,
,((, -
$num((. /
,((/ 0
$num((1 2
)((2 3
)((3 4
;((4 5
migrationBuilder** 
.** 
	AddColumn** &
<**& '
string**' -
>**- .
(**. /
name++ 
:++ 
$str++ 
,++ 
table,, 
:,, 
$str,, 
,,, 
type-- 
:-- 
$str-- 
,-- 
nullable.. 
:.. 
false.. 
,..  
defaultValue// 
:// 
$str//  
)//  !
;//! "
migrationBuilder11 
.11 
	AddColumn11 &
<11& '
string11' -
>11- .
(11. /
name22 
:22 
$str22  
,22  !
table33 
:33 
$str33 
,33 
type44 
:44 
$str44 
,44 
nullable55 
:55 
true55 
)55 
;55  
migrationBuilder77 
.77 
	AddColumn77 &
<77& '
string77' -
>77- .
(77. /
name88 
:88 
$str88 $
,88$ %
table99 
:99 
$str99 
,99 
type:: 
::: 
$str:: 
,:: 
nullable;; 
:;; 
true;; 
);; 
;;;  
migrationBuilder== 
.== 
	AddColumn== &
<==& '
string==' -
>==- .
(==. /
name>> 
:>> 
$str>> 
,>>  
table?? 
:?? 
$str?? 
,?? 
type@@ 
:@@ 
$str@@ 
,@@ 
nullableAA 
:AA 
falseAA 
,AA  
defaultValueBB 
:BB 
$strBB  
)BB  !
;BB! "
migrationBuilderDD 
.DD 
	AddColumnDD &
<DD& '
DateTimeDD' /
>DD/ 0
(DD0 1
nameEE 
:EE 
$strEE "
,EE" #
tableFF 
:FF 
$strFF 
,FF 
typeGG 
:GG 
$strGG 
,GG 
nullableHH 
:HH 
falseHH 
,HH  
defaultValueII 
:II 
newII !
DateTimeII" *
(II* +
$numII+ ,
,II, -
$numII. /
,II/ 0
$numII1 2
,II2 3
$numII4 5
,II5 6
$numII7 8
,II8 9
$numII: ;
,II; <
$numII= >
,II> ?
DateTimeKindII@ L
.IIL M
UnspecifiedIIM X
)IIX Y
)IIY Z
;IIZ [
migrationBuilderKK 
.KK 
	AddColumnKK &
<KK& '
stringKK' -
>KK- .
(KK. /
nameLL 
:LL 
$strLL "
,LL" #
tableMM 
:MM 
$strMM 
,MM 
typeNN 
:NN 
$strNN 
,NN 
nullableOO 
:OO 
trueOO 
)OO 
;OO  
migrationBuilderQQ 
.QQ 
CreateTableQQ (
(QQ( )
nameRR 
:RR 
$strRR 
,RR 
columnsSS 
:SS 
tableSS 
=>SS !
newSS" %
{TT 
IdUU 
=UU 
tableUU 
.UU 
ColumnUU %
<UU% &
intUU& )
>UU) *
(UU* +
typeUU+ /
:UU/ 0
$strUU1 :
,UU: ;
nullableUU< D
:UUD E
falseUUF K
)UUK L
.VV 

AnnotationVV #
(VV# $
$strVV$ :
,VV: ;
trueVV< @
)VV@ A
,VVA B
UrlWW 
=WW 
tableWW 
.WW  
ColumnWW  &
<WW& '
stringWW' -
>WW- .
(WW. /
typeWW/ 3
:WW3 4
$strWW5 ;
,WW; <
nullableWW= E
:WWE F
falseWWG L
)WWL M
,WWM N
IsMainXX 
=XX 
tableXX "
.XX" #
ColumnXX# )
<XX) *
boolXX* .
>XX. /
(XX/ 0
typeXX0 4
:XX4 5
$strXX6 ?
,XX? @
nullableXXA I
:XXI J
falseXXK P
)XXP Q
,XXQ R
PublicIdYY 
=YY 
tableYY $
.YY$ %
ColumnYY% +
<YY+ ,
stringYY, 2
>YY2 3
(YY3 4
typeYY4 8
:YY8 9
$strYY: @
,YY@ A
nullableYYB J
:YYJ K
trueYYL P
)YYP Q
,YYQ R
UserIdZZ 
=ZZ 
tableZZ "
.ZZ" #
ColumnZZ# )
<ZZ) *
intZZ* -
>ZZ- .
(ZZ. /
typeZZ/ 3
:ZZ3 4
$strZZ5 >
,ZZ> ?
nullableZZ@ H
:ZZH I
falseZZJ O
)ZZO P
}[[ 
,[[ 
constraints\\ 
:\\ 
table\\ "
=>\\# %
{]] 
table^^ 
.^^ 

PrimaryKey^^ $
(^^$ %
$str^^% 0
,^^0 1
x^^2 3
=>^^4 6
x^^7 8
.^^8 9
Id^^9 ;
)^^; <
;^^< =
table__ 
.__ 

ForeignKey__ $
(__$ %
name`` 
:`` 
$str`` 6
,``6 7
columnaa 
:aa 
xaa  !
=>aa" $
xaa% &
.aa& '
UserIdaa' -
,aa- .
principalTablebb &
:bb& '
$strbb( /
,bb/ 0
principalColumncc '
:cc' (
$strcc) -
,cc- .
onDeletedd  
:dd  !
ReferentialActiondd" 3
.dd3 4
Cascadedd4 ;
)dd; <
;dd< =
}ee 
)ee 
;ee 
migrationBuildergg 
.gg 
CreateIndexgg (
(gg( )
namehh 
:hh 
$strhh (
,hh( )
tableii 
:ii 
$strii 
,ii  
columnjj 
:jj 
$strjj  
)jj  !
;jj! "
}kk 	
	protectednn 
overridenn 
voidnn 
Downnn  $
(nn$ %
MigrationBuildernn% 5
migrationBuildernn6 F
)nnF G
{oo 	
migrationBuilderpp 
.pp 
	DropTablepp &
(pp& '
nameqq 
:qq 
$strqq 
)qq 
;qq  
migrationBuilderss 
.ss 

DropColumnss '
(ss' (
namett 
:tt 
$strtt 
,tt 
tableuu 
:uu 
$struu 
)uu 
;uu  
migrationBuilderww 
.ww 

DropColumnww '
(ww' (
namexx 
:xx 
$strxx 
,xx  
tableyy 
:yy 
$stryy 
)yy 
;yy  
migrationBuilder{{ 
.{{ 

DropColumn{{ '
({{' (
name|| 
:|| 
$str|| 
,||  
table}} 
:}} 
$str}} 
)}} 
;}}  
migrationBuilder 
. 

DropColumn '
(' (
name
€€ 
:
€€ 
$str
€€ #
,
€€# $
table
 
:
 
$str
 
)
 
;
  
migrationBuilder
ƒƒ 
.
ƒƒ 

DropColumn
ƒƒ '
(
ƒƒ' (
name
„„ 
:
„„ 
$str
„„ 
,
„„ 
table
…… 
:
…… 
$str
…… 
)
…… 
;
……  
migrationBuilder
‡‡ 
.
‡‡ 

DropColumn
‡‡ '
(
‡‡' (
name
ˆˆ 
:
ˆˆ 
$str
ˆˆ  
,
ˆˆ  !
table
‰‰ 
:
‰‰ 
$str
‰‰ 
)
‰‰ 
;
‰‰  
migrationBuilder
‹‹ 
.
‹‹ 

DropColumn
‹‹ '
(
‹‹' (
name
ŒŒ 
:
ŒŒ 
$str
ŒŒ $
,
ŒŒ$ %
table
 
:
 
$str
 
)
 
;
  
migrationBuilder
 
.
 

DropColumn
 '
(
' (
name
 
:
 
$str
 
,
  
table
‘‘ 
:
‘‘ 
$str
‘‘ 
)
‘‘ 
;
‘‘  
migrationBuilder
““ 
.
““ 

DropColumn
““ '
(
““' (
name
”” 
:
”” 
$str
”” "
,
””" #
table
•• 
:
•• 
$str
•• 
)
•• 
;
••  
migrationBuilder
—— 
.
—— 

DropColumn
—— '
(
——' (
name
˜˜ 
:
˜˜ 
$str
˜˜ "
,
˜˜" #
table
™™ 
:
™™ 
$str
™™ 
)
™™ 
;
™™  
}
šš 	
}
›› 
}œœ ê
kC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Data\Migrations\20250617042857_UpdatedUserEntity.cs
	namespace 	
	SimpleAPI
 
. 
Data 
. 

Migrations #
{ 
public 

partial 
class 
UpdatedUserEntity *
:+ ,
	Migration- 6
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
RenameColumn )
() *
name 
: 
$str !
,! "
table 
: 
$str 
, 
newName 
: 
$str #
)# $
;$ %
migrationBuilder 
. 
	AddColumn &
<& '
byte' +
[+ ,
], -
>- .
(. /
name 
: 
$str $
,$ %
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue 
: 
new !
byte" &
[& '
$num' (
]( )
)) *
;* +
migrationBuilder 
. 
	AddColumn &
<& '
byte' +
[+ ,
], -
>- .
(. /
name 
: 
$str $
,$ %
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue 
: 
new !
byte" &
[& '
$num' (
]( )
)) *
;* +
} 	
	protected"" 
override"" 
void"" 
Down""  $
(""$ %
MigrationBuilder""% 5
migrationBuilder""6 F
)""F G
{## 	
migrationBuilder$$ 
.$$ 

DropColumn$$ '
($$' (
name%% 
:%% 
$str%% $
,%%$ %
table&& 
:&& 
$str&& 
)&& 
;&&  
migrationBuilder(( 
.(( 

DropColumn(( '
(((' (
name)) 
:)) 
$str)) $
,))$ %
table** 
:** 
$str** 
)** 
;**  
migrationBuilder,, 
.,, 
RenameColumn,, )
(,,) *
name-- 
:-- 
$str--  
,--  !
table.. 
:.. 
$str.. 
,.. 
newName// 
:// 
$str// $
)//$ %
;//% &
}00 	
}11 
}22 ‘
lC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Data\Migrations\20250612170226_InitialMigarations.cs
	namespace 	
	SimpleAPI
 
. 
Data 
. 

Migrations #
{ 
public 

partial 
class 
InitialMigarations +
:, -
	Migration. 7
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ :
,: ;
true< @
)@ A
,A B
	FirstName 
= 
table  %
.% &
Column& ,
<, -
string- 3
>3 4
(4 5
type5 9
:9 :
$str; A
,A B
nullableC K
:K L
falseM R
)R S
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
Id8 :
): ;
;; <
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str 
) 
; 
}   	
}!! 
}"" »
LC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Data\AppDbContext.cs
	namespace 	
	SimpleAPI
 
. 
Data 
{ 
public 

class 
AppDbContext 
( 
DbContextOptions .
<. /
AppDbContext/ ;
>; <
options= D
)D E
:F G
	DbContextH Q
(Q R
optionsR Y
)Y Z
{ 
public		 
DbSet		 
<		 
User		 
>		 
Users		  
{		! "
get		# &
;		& '
set		( +
;		+ ,
}		- .
=		/ 0
null		1 5
!		5 6
;		6 7
public

 
DbSet

 
<

 
UserLike

 
>

 
Likes

 $
{

% &
get

' *
;

* +
set

, /
;

/ 0
}

1 2
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
builder= D
)D E
{ 	
base 
. 
OnModelCreating  
(  !
builder! (
)( )
;) *
builder 
. 
Entity 
< 
UserLike #
># $
($ %
)% &
. 
HasKey 
( 
key 
=> 
new "
{# $
key% (
.( )
SourceUserId) 5
,5 6
key7 :
.: ;
TargetUserId; G
}H I
)I J
;J K
builder 
. 
Entity 
< 
UserLike #
># $
($ %
)% &
. 
HasOne 
( 
source 
=> !
source" (
.( )

SourceUser) 3
)3 4
. 
WithMany 
( 
like 
=> !
like" &
.& '

LikedUsers' 1
)1 2
. 
HasForeignKey 
( 
s  
=>! #
s$ %
.% &
SourceUserId& 2
)2 3
. 
OnDelete 
( 
DeleteBehavior (
.( )
Cascade) 0
)0 1
;1 2
builder 
. 
Entity 
< 
UserLike #
># $
($ %
)% &
. 
HasOne 
( 
source 
=> !
source" (
.( )

TargetUser) 3
)3 4
. 
WithMany 
( 
like 
=> !
like" &
.& '
LikedByUsers' 3
)3 4
. 
HasForeignKey 
( 
source %
=>& (
source) /
./ 0
TargetUserId0 <
)< =
. 
OnDelete 
( 
DeleteBehavior (
.( )
Cascade) 0
)0 1
;1 2
} 	
} 
}   ‘e
VC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Controllers\UsersController.cs
	namespace 	
	SimpleAPI
 
. 
Controllers 
;  
[ 
	Authorize 

]
 
public 
class 
UsersController 
( 
IUserRepository ,
userRepository- ;
,; <
IMapper= D
mapperE K
,K L
IPhotoServiceM Z
photoService[ g
)g h
:i j
BaseApiControllerk |
{ 
[ 
HttpGet 
] 
public 

async 
Task 
< 
ActionResult "
<" #
IEnumerable# .
<. /
	MemberDto/ 8
>8 9
>9 :
>: ;
GetAllUsers< G
(G H
[H I
	FromQueryI R
]R S

UserParamsS ]

userParams^ h
)h i
{ 

userParams 
. 
CurrentUsername "
=# $
User% )
.) *
GetUserName* 5
(5 6
)6 7
;7 8
var 
users 
= 
await 
userRepository (
.( )
GetMembersAsync) 8
(8 9

userParams9 C
)C D
;D E
Response 
. 
AddPaginationHeader $
($ %
users% *
)* +
;+ ,
return 
Ok 
( 
users 
) 
; 
} 
[ 
HttpGet 
( 
$str 
) 
] 
public 

async 
Task 
< 
ActionResult "
<" #
	MemberDto# ,
>, -
>- .
GetUserById/ :
(: ;
int; >
id? A
)A B
{ 
var 
User 
= 
await 
userRepository '
.' (
GetMemberByIdAsync( :
(: ;
id; =
)= >
;> ?
if 

( 
User 
== 
null 
) 
return  
NotFound! )
() *
)* +
;+ ,
return!! 
Ok!! 
(!! 
mapper!! 
.!! 
Map!! 
<!! 
	MemberDto!! &
>!!& '
(!!' (
User!!( ,
)!!, -
)!!- .
;!!. /
}"" 
[$$ 
HttpGet$$ 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 

async%% 
Task%% 
<%% 
ActionResult%% "
<%%" #
	MemberDto%%# ,
>%%, -
>%%- .
GetUserByUsername%%/ @
(%%@ A
string%%A G
username%%H P
)%%P Q
{&& 
var'' 
User'' 
='' 
await'' 
userRepository'' '
.''' ($
GetMemberByUserNameAsync''( @
(''@ A
username''A I
)''I J
;''J K
return(( 
Ok(( 
((( 
User(( 
)(( 
;(( 
})) 
[++ 
HttpPut++ 
]++ 
public,, 

async,, 
Task,, 
<,, 
ActionResult,, "
>,," #

UpdateUser,,$ .
(,,. /
MemberUpdateDto,,/ >
memberUpdateDto,,? N
),,N O
{-- 
var.. 
username.. 
=.. 
User.. 
... 
GetUserName.. '
(..' (
)..( )
;..) *
if00 

(00 
username00 
==00 
null00 
)00 
return00 $

BadRequest00% /
(00/ 0
$str000 V
)00V W
;00W X
var11 
user11 
=11 
await11 
userRepository11 '
.11' ("
GetUserByUserNameAsync11( >
(11> ?
username11? G
)11G H
;11H I
if33 

(33 
user33 
==33 
null33 
)33 
return33  

BadRequest33! +
(33+ ,
$str33, A
)33A B
;33B C
mapper55 
.55 
Map55 
(55 
memberUpdateDto55 "
,55" #
user55$ (
)55( )
;55) *
if66 

(66 
await66 
userRepository66  
.66  !
SaveAllAsync66! -
(66- .
)66. /
)66/ 0
return661 7
	NoContent668 A
(66A B
)66B C
;66C D
return88 

BadRequest88 
(88 
$str88 5
)885 6
;886 7
}99 
[<< 
HttpPost<< 
(<< 
$str<< 
)<< 
]<< 
public== 

async== 
Task== 
<== 
ActionResult== "
<==" #
PhotoDto==# +
>==+ ,
>==, -
AddPhoto==. 6
(==6 7
	IFormFile==7 @
file==A E
)==E F
{>> 
var?? 
user?? 
=?? 
await?? 
userRepository?? '
.??' ("
GetUserByUserNameAsync??( >
(??> ?
User??? C
.??C D
GetUserName??D O
(??O P
)??P Q
)??Q R
;??R S
if@@ 

(@@ 
user@@ 
==@@ 
null@@ 
)@@ 
return@@  

BadRequest@@! +
(@@+ ,
$str@@, E
)@@E F
;@@F G
varBB 
resultBB 
=BB 
awaitBB 
photoServiceBB '
.BB' (
AddPhotoAsyncBB( 5
(BB5 6
fileBB6 :
)BB: ;
;BB; <
ifCC 

(CC 
resultCC 
.CC 
ErrorCC 
!=CC 
nullCC  
)CC  !
returnCC" (

BadRequestCC) 3
(CC3 4
resultCC4 :
.CC: ;
ErrorCC; @
.CC@ A
MessageCCA H
)CCH I
;CCI J
varEE 
photoEE 
=EE 
newEE 
PhotoEE 
{FF 	
UrlGG 
=GG 
resultGG 
.GG 
	SecureUrlGG "
.GG" #
AbsoluteUriGG# .
,GG. /
PublicIdHH 
=HH 
resultHH 
.HH 
PublicIdHH &
}II 	
;II	 

ifKK 

(KK 
userKK 
.KK 
PhotosKK 
.KK 
CountKK 
==KK  
$numKK! "
)KK" #
photoKK$ )
.KK) *
IsMainKK* 0
=KK1 2
trueKK3 7
;KK7 8
userMM 
.MM 
PhotosMM 
.MM 
AddMM 
(MM 
photoMM 
)MM 
;MM 
ifOO 

(OO 
awaitOO 
userRepositoryOO  
.OO  !
SaveAllAsyncOO! -
(OO- .
)OO. /
)OO/ 0
returnPP 
CreatedAtActionPP "
(PP" #
nameofQQ 
(QQ 
GetUserByUsernameQQ ,
)QQ, -
,QQ- .
newRR 
{RR 
usernameRR "
=RR# $
userRR% )
.RR) *
UserNameRR* 2
}RR3 4
,RR4 5
mapperSS 
.SS 
MapSS 
<SS 
PhotoDtoSS '
>SS' (
(SS( )
photoSS) .
)SS. /
)TT 
;TT 
returnUU 

BadRequestUU 
(UU 
$strUU .
)UU. /
;UU/ 0
}VV 
[YY 
HttpPutYY 
(YY 
$strYY +
)YY+ ,
]YY, -
publicZZ 

asyncZZ 
TaskZZ 
<ZZ 
ActionResultZZ "
>ZZ" #
SetMainPhotoZZ$ 0
(ZZ0 1
intZZ1 4
photoIdZZ5 <
)ZZ< =
{[[ 
var\\ 
user\\ 
=\\ 
await\\ 
userRepository\\ '
.\\' ("
GetUserByUserNameAsync\\( >
(\\> ?
User\\? C
.\\C D
GetUserName\\D O
(\\O P
)\\P Q
)\\Q R
;\\R S
if]] 

(]] 
user]] 
==]] 
null]] 
)]] 
return]]  

BadRequest]]! +
(]]+ ,
$str]], A
)]]A B
;]]B C
var__ 
photo__ 
=__ 
user__ 
.__ 
Photos__ 
.__  
FirstOrDefault__  .
(__. /
x__/ 0
=>__1 3
x__4 5
.__5 6
Id__6 8
==__9 ;
photoId__< C
)__C D
;__D E
ifaa 

(aa 
photoaa 
==aa 
nullaa 
||aa 
photoaa "
.aa" #
IsMainaa# )
)aa) *
returnaa+ 1

BadRequestaa2 <
(aa< =
$straa= `
)aa` a
;aaa b
varcc 
currentMaincc 
=cc 
usercc 
.cc 
Photoscc %
.cc% &
FirstOrDefaultcc& 4
(cc4 5
xcc5 6
=>cc7 9
xcc: ;
.cc; <
IsMaincc< B
)ccB C
;ccC D
ifdd 

(dd 
currentMaindd 
!=dd 
nulldd 
)dd  
currentMaindd! ,
.dd, -
IsMaindd- 3
=dd4 5
falsedd6 ;
;dd; <
photoee 
.ee 
IsMainee 
=ee 
trueee 
;ee 
ifgg 

(gg 
awaitgg 
userRepositorygg  
.gg  !
SaveAllAsyncgg! -
(gg- .
)gg. /
)gg/ 0
returngg1 7
	NoContentgg8 A
(ggA B
)ggB C
;ggC D
returnii 

BadRequestii 
(ii 
$strii :
)ii: ;
;ii; <
}jj 
[mm 

HttpDeletemm 
(mm 
$strmm ,
)mm, -
]mm- .
publicnn 

asyncnn 
Tasknn 
<nn 
ActionResultnn "
>nn" #
DeletePhotonn$ /
(nn/ 0
intnn0 3
photoIdnn4 ;
)nn; <
{oo 
varpp 
userpp 
=pp 
awaitpp 
userRepositorypp '
.pp' ("
GetUserByUserNameAsyncpp( >
(pp> ?
Userpp? C
.ppC D
GetUserNameppD O
(ppO P
)ppP Q
)ppQ R
;ppR S
ifqq 

(qq 
userqq 
==qq 
nullqq 
)qq 
returnqq  

BadRequestqq! +
(qq+ ,
$strqq, A
)qqA B
;qqB C
varss 
photoss 
=ss 
userss 
.ss 
Photosss 
.ss  
FirstOrDefaultss  .
(ss. /
xss/ 0
=>ss1 3
xss4 5
.ss5 6
Idss6 8
==ss9 ;
photoIdss< C
)ssC D
;ssD E
ifuu 

(uu 
photouu 
==uu 
nulluu 
||uu 
photouu "
.uu" #
IsMainuu# )
)uu) *
returnuu+ 1

BadRequestuu2 <
(uu< =
$struu= W
)uuW X
;uuX Y
ifvv 

(vv 
photovv 
.vv 
PublicIdvv 
!=vv 
nullvv "
)vv" #
{ww 	
varxx 
resultxx 
=xx 
awaitxx 
photoServicexx +
.xx+ ,
DeletePhotoAsyncxx, <
(xx< =
photoxx= B
.xxB C
PublicIdxxC K
)xxK L
;xxL M
ifyy 
(yy 
resultyy 
.yy 
Erroryy 
!=yy 
nullyy  $
)yy$ %
returnyy& ,

BadRequestyy- 7
(yy7 8
resultyy8 >
.yy> ?
Erroryy? D
.yyD E
MessageyyE L
)yyL M
;yyM N
}zz 	
user{{ 
.{{ 
Photos{{ 
.{{ 
Remove{{ 
({{ 
photo{{  
){{  !
;{{! "
if|| 

(|| 
await|| 
userRepository||  
.||  !
SaveAllAsync||! -
(||- .
)||. /
)||/ 0
return||1 7
Ok||8 :
(||: ;
)||; <
;||< =
return}} 

BadRequest}} 
(}} 
$str}} :
)}}: ;
;}}; <
}~~ 
} ˜
VC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Controllers\LikesController.cs
	namespace 	
	SimpleAPI
 
. 
Controllers 
;  
public 
class 
LikesController 
( 
ILikesRepository -
likesRepository. =
)= >
:? @
BaseApiControllerA R
{ 
[ 
HttpPut 
( 
$str !
)! "
]" #
public 

async 
Task 
< 
ActionResult "
>" #

ToggleLike$ .
(. /
int/ 2
targetUserId3 ?
)? @
{ 
var 
sourceUserId 
= 
User 
.  
	GetUserId  )
() *
)* +
;+ ,
if 

( 
sourceUserId 
== 
targetUserId (
)( )
return* 0

BadRequest1 ;
(; <
$str< V
)V W
;W X
var 
existingLike 
= 
await  
likesRepository! 0
.0 1
GetUserLike1 <
(< =
sourceUserId= I
,I J
targetUserIdK W
)W X
;X Y
if 

( 
existingLike 
== 
null  
)  !
{ 	
var 
like 
= 
new 
UserLike #
{ 
SourceUserId 
= 
sourceUserId +
,+ ,
TargetUserId 
= 
targetUserId +
} 
; 
likesRepository 
. 
AddLike #
(# $
like$ (
)( )
;) *
} 	
else   
{!! 	
likesRepository"" 
."" 

DeleteLike"" &
(""& '
existingLike""' 3
)""3 4
;""4 5
}## 	
if%% 

(%% 
await%% 
likesRepository%% !
.%%! "
SaveChanges%%" -
(%%- .
)%%. /
)%%/ 0
return%%1 7
Ok%%8 :
(%%: ;
)%%; <
;%%< =
return&& 

BadRequest&& 
(&& 
$str&& 1
)&&1 2
;&&2 3
}'' 
[)) 
HttpGet)) 
()) 
$str)) 
))) 
])) 
public** 

async** 
Task** 
<** 
ActionResult** "
<**" #
IEnumerable**# .
<**. /
int**/ 2
>**2 3
>**3 4
>**4 5"
GetCurrentUserLikedIds**6 L
(**L M
)**M N
{++ 
return,, 
Ok,, 
(,, 
await,, 
likesRepository,, '
.,,' (!
GetCurrentUserLikeIds,,( =
(,,= >
User,,> B
.,,B C
	GetUserId,,C L
(,,L M
),,M N
),,N O
),,O P
;,,P Q
}-- 
[// 
HttpGet// 
]// 
public00 

async00 
Task00 
<00 
ActionResult00 "
<00" #
IEnumerable00# .
<00. /
	MemberDto00/ 8
>008 9
>009 :
>00: ;
GetUserLikes00< H
(00H I
string00I O
	predicate00P Y
)00Y Z
{11 
var22 
users22 
=22 
await22 
likesRepository22 )
.22) *
GetUserLikes22* 6
(226 7
	predicate227 @
,22@ A
User22B F
.22F G
	GetUserId22G P
(22P Q
)22Q R
)22R S
;22S T
return33 
Ok33 
(33 
users33 
)33 
;33 
}44 
}77 ¶
\C:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Controllers\HealthCheckController.cs
	namespace 	
	SimpleAPI
 
. 
Controllers 
;  
public 
class !
HealthCheckController "
:# $
BaseApiController% 6
{ 
[ 
HttpGet 
] 
public 

IActionResult 
Get 
( 
) 
{		 
return

 
Ok

 
(

 
new

 
{

 
message

 
=

  !
$str

" @
}

@ A
)

A B
;

B C
} 
} ˜
VC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Controllers\BuggyController.cs
	namespace 	
	SimpleAPI
 
. 
Controllers 
;  
public 
class 
BuggyController 
( 
AppDbContext )
context* 1
)1 2
:3 4
BaseApiController5 F
{		 
[ 
	Authorize 
] 
[ 
HttpGet 
( 
$str 
) 
] 
public 

ActionResult 
< 
string 
> 
GetAuth  '
(' (
)( )
{ 
return 
$str 
; 
} 
[ 
HttpGet 
( 
$str 
) 
] 
public 

ActionResult 
< 
string 
> 
GetNotFound  +
(+ ,
), -
{ 
var 
thing 
= 
context 
. 
Users !
.! "
Find" &
(& '
-' (
$num( )
)) *
;* +
if 

( 
thing 
== 
null 
) 
return !
NotFound" *
(* +
)+ ,
;, -
return 
$str 
; 
} 
[ 
HttpGet 
( 
$str 
) 
] 
public 

ActionResult 
< 
User 
> 
GetServerError ,
(, -
)- .
{ 
var 
thing 
= 
context 
. 
Users !
.! "
Find" &
(& '
-' (
$num( )
)) *
??+ -
throw. 3
new4 7
	Exception8 A
(A B
$strB k
)k l
;l m
return!! 
thing!! 
;!! 
}"" 
[%% 
HttpGet%% 
(%% 
$str%% 
)%% 
]%% 
public&& 

ActionResult&& 
<&& 
string&& 
>&& 
GetBadRequest&&  -
(&&- .
)&&. /
{'' 
return(( 

BadRequest(( 
((( 
$str(( 7
)((7 8
;((8 9
})) 
}++ €
XC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Controllers\BaseApiController.cs
	namespace 	
	SimpleAPI
 
. 
Controllers 
;  
[ 
ServiceFilter 
( 
typeof 
( 
LogUserActivity %
)% &
)& '
]' (
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public		 
class		 
BaseApiController		 
:		  
ControllerBase		! /
{

 
} ê7
YC:\Users\shohail.parwej\Angular-Dotnet\DotNet\SimpleAPI\Controllers\AccountsController.cs
	namespace 	
	SimpleAPI
 
. 
Controllers 
;  
public 
class 
AccountsController 
(  
AppDbContext  ,
context- 4
,4 5
ITokenService6 C
tokenServiceD P
,P Q
IMapperR Y
mapperZ `
)` a
:b c
BaseApiControllerd u
{ 
[ 
HttpPost 
( 
$str 
) 
] 
public 

async 
Task 
< 
ActionResult "
<" #
UserDto# *
>* +
>+ ,
RegisterUser- 9
(9 :
RegisterDto: E
registerDtoF Q
)Q R
{ 
if 

( 
await 

UserExists 
( 
registerDto (
.( )
Username) 1
)1 2
)2 3
return4 :

BadRequest; E
(E F
$strF _
)_ `
;` a
using 
var 
hmac 
= 
new 

HMACSHA512 '
(' (
)( )
;) *
var 
user 
= 
mapper 
. 
Map 
< 
User "
>" #
(# $
registerDto$ /
)/ 0
;0 1
user 
. 
UserName 
= 
registerDto #
.# $
Username$ ,
., -
ToLower- 4
(4 5
)5 6
;6 7
user 
. 
PasswordHash 
= 
hmac  
.  !
ComputeHash! ,
(, -
Encoding- 5
.5 6
UTF86 :
.: ;
GetBytes; C
(C D
registerDtoD O
.O P
PasswordP X
)X Y
)Y Z
;Z [
user 
. 
PasswordSalt 
= 
hmac  
.  !
Key! $
;$ %
context 
. 
Users 
. 
Add 
( 
user 
) 
;  
await 
context 
. 
SaveChangesAsync &
(& '
)' (
;( )
return 
new 
UserDto 
{ 	
Username   
=   
user   
.   
UserName   $
,  $ %
Token!! 
=!! 
tokenService!!  
.!!  !
CreateToken!!! ,
(!!, -
user!!- 1
)!!1 2
,!!2 3
KnownAs"" 
="" 
user"" 
."" 
KnownAs"" "
,""" #
Gender## 
=## 
user## 
.## 
Gender##  
}$$ 	
;$$	 

}%% 
['' 
HttpPost'' 
('' 
$str'' 
)'' 
]'' 
public(( 

async(( 
Task(( 
<(( 
ActionResult(( "
<((" #
UserDto((# *
>((* +
>((+ ,
	LoginUser((- 6
(((6 7
LoginDto((7 ?
loginDto((@ H
)((H I
{)) 
var** 
user** 
=** 
await** 
context**  
.**  !
Users**! &
.++ 	
Include++	 
(++ 
p++ 
=>++ 
p++ 
.++ 
Photos++ 
)++ 
.,, 	
FirstOrDefaultAsync,,	 
(,, 
x-- 
=>-- 
x-- 
.-- 
UserName-- 
.-- 
ToLower-- #
(--# $
)--$ %
==--& (
loginDto--) 1
.--1 2
Username--2 :
.--: ;
ToLower--; B
(--B C
)--C D
).. 	
;..	 

if00 

(00 
user00 
==00 
null00 
)00 
return00  
Unauthorized00! -
(00- .
$str00. @
)00@ A
;00A B
var22 
hmac22 
=22 
new22 

HMACSHA51222 !
(22! "
user22" &
.22& '
PasswordSalt22' 3
)223 4
;224 5
var33 
computedHash33 
=33 
hmac33 
.33  
ComputeHash33  +
(33+ ,
Encoding33, 4
.334 5
UTF8335 9
.339 :
GetBytes33: B
(33B C
loginDto33C K
.33K L
Password33L T
)33T U
)33U V
;33V W
for55 
(55 
int55 
i55 
=55 
$num55 
;55 
i55 
<55 
computedHash55 (
.55( )
Length55) /
;55/ 0
i551 2
++552 4
)554 5
{66 	
if77 
(77 
computedHash77 
[77 
i77 
]77 
!=77  "
user77# '
.77' (
PasswordHash77( 4
[774 5
i775 6
]776 7
)777 8
{88 
return99 
Unauthorized99 #
(99# $
$str99$ 6
)996 7
;997 8
}:: 
};; 	
return== 
new== 
UserDto== 
{>> 	
Username?? 
=?? 
user?? 
.?? 
UserName?? $
,??$ %
Token@@ 
=@@ 
tokenService@@  
.@@  !
CreateToken@@! ,
(@@, -
user@@- 1
)@@1 2
,@@2 3
KnownAsAA 
=AA 
userAA 
.AA 
KnownAsAA "
,AA" #
PhotoUrlBB 
=BB 
userBB 
.BB 
PhotosBB "
.BB" #
FirstOrDefaultBB# 1
(BB1 2
xBB2 3
=>BB4 6
xBB7 8
.BB8 9
IsMainBB9 ?
)BB? @
?BB@ A
.BBA B
UrlBBB E
,BBE F
GenderCC 
=CC 
userCC 
.CC 
GenderCC  
}DD 	
;DD	 

}EE 
privateHH 
asyncHH 
TaskHH 
<HH 
boolHH 
>HH 

UserExistsHH '
(HH' (
stringHH( .
usernameHH/ 7
)HH7 8
{II 
returnJJ 
awaitJJ 
contextJJ 
.JJ 
UsersJJ "
.JJ" #
AnyAsyncJJ# +
(JJ+ ,
xJJ, -
=>JJ. 0
xJJ1 2
.JJ2 3
UserNameJJ3 ;
.JJ; <
ToLowerJJ< C
(JJC D
)JJD E
==JJF H
usernameJJI Q
.JJQ R
ToLowerJJR Y
(JJY Z
)JJZ [
)JJ[ \
;JJ\ ]
}KK 
}LL 